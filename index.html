<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lending Manager</title>
  <link rel="stylesheet" href="style.css"/>
  <!-- Firebase SDKs (compat for simplicity) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
</head>
<body>
  <div id="app">
    <!-- Sidebar (overlay) -->
    <aside id="sidebar" class="collapsed">
      <div class="brand">
        <span class="brand-name">Menu</span>
      </div>
      <nav class="menu">
        <button class="menu-item" id="menuSearchAccounts" data-target="page-search-accounts">Search Accounts</button>
<div class="menu-group">
          <div class="menu-item has-children"><span>Admin</span></div>
          <div class="sub-menu">
            <button class="menu-item" id="menuAdminPayments" data-target="page-admin-payments">Payment Entries</button>
            <button class="menu-item" id="menuAdminUsers" data-target="page-admin-users">Users</button>
          </div>
        </div>
        <button class="menu-item" id="menuSettings" data-target="page-settings">Settings</button>
      </nav>
      <footer class="sidebar-footer">
        <div class="sidebar-auth">
          <div><small>Admin Auth:</small><span id="adminAuthState" class="pill danger">Signed out</span></div>
          <div class="btn-row"><button id="btnAdminLogout" class="ghost small">Logout</button></div></div>
</footer>
    </aside>
    <div id="sidebarBackdrop" class="backdrop hidden"></div>

    <!-- Main content -->
    <main id="content">
      <header class="topbar">
        <button id="btnHamburgerTop" class="ghost" aria-label="Toggle menu">☰</button> <h1 class="app-title">Lending Manager</h1><div class="spacer"></div>
        <span class="status-dot" id="statusDot" title="Database status"></span>
      </header>

      <!-- Pages -->

<section id="page-search-accounts" class="page visible">
  <div class="card">
    <div class="flex-row between">
      <h2>Search Accounts & Payments</h2>
    </div>
    <details class="card sub" open>
      <summary>Find an Account (from <code>/accounts</code>)</summary>
      <div class="grid grid-3 gap">
        <div class="col-span-2">
          <label>Search by Account ID or Name</label>
          <input id="accSearchInput" placeholder="Type to search..."/>
        </div>
        <div class="align-end">
          <button id="btnClearAccSearch" class="ghost">Clear</button>
        </div>
      </div>
      <div id="accSearchResults" class="list"></div>
    </details>

    <details class="card sub" open>
      <summary>Selected Account</summary>
      <div class="grid grid-3 gap">
        <div><label>Account ID</label><input id="sAccId" readonly/></div>
        <div><label>Account Name</label><input id="sAccName" readonly/></div>
        <div class="align-end"><span class="pill">Read-only view</span></div>
      </div>
    </details>

    <div class="table-wrap">
      <table id="searchPaymentsTable">
        <thead>
          <tr><th>#</th><th>Credit</th><th>Additional</th><th>Payment</th><th>Misc</th><th>Balance</th><th>Percent (%)</th><th>Date</th><th>Notes</th></tr>
        </thead>
        <tbody></tbody>
        <tfoot>
          <tr id="searchPaymentsTotals"><td>Σ</td><td>–</td><td>0.00</td><td>0.00</td><td>0.00</td><td>–</td><td>–</td><td></td><td></td></tr>
        </tfoot>
      </table>
    </div>
  </div>
</section>

<section id="page-admin-payments" class="page">
        <div class="card">
          <div class="flex-row between">
            <h2>Payment Entries</h2></div>
<details class="card sub" open>
            <summary>Step 1 — Find a User (from <code>/users</code>)</summary>
            <div class="grid grid-3 gap">
              <div class="col-span-2">
                <label>Search by Account ID, Account Name, or Email</label>
                <input id="userSearchInput" placeholder="Type to search..."/>
              </div>
              <div class="align-end">
                <button id="btnClearUserSearch" class="ghost">Clear</button>
              </div>
            </div>
            <div id="userSearchResults" class="list"></div>
            
          </details>

          <details class="card sub" open>
            <summary>Step 2 — Selected Account</summary>
            <div class="grid grid-3 gap">
              <div><label>Account ID</label><input id="accId" readonly/></div>
              <div><label>Account Name</label><input id="accName" readonly/></div>
              <div class="align-end">
              </div>
            </div>
          </details>

          
<div id="adminStats" class="stat-cards">
  <div class="stat">
    <div class="stat-label">Total Given</div>
    <div class="stat-value" id="statTotalAdd">QAR 0.00</div>
  </div>
  <div class="stat">
    <div class="stat-label">Total Collected</div>
    <div class="stat-value" id="statTotalPay">QAR 0.00</div>
  </div>
  <div class="stat">
    <div class="stat-label">Current Balance</div>
    <div class="stat-value" id="statCurrentBal">QAR 0.00</div>
  </div>
  <div class="stat">
    <div class="stat-label">Next Collection Date</div>
    <div class="stat-value" id="statNextDate">—</div>
  </div>
  <div class="stat">
    <div class="stat-label">Collection Amount</div>
    <div class="stat-value" id="statNextAmount">QAR 0.00</div>
  </div>
</div>
<details class="card sub" open>
            <summary>Step 3 — Add / Update Payment Entry</summary>
            <div class="grid grid-6 gap">
              <div><label>Credit Amount</label><input id="peCredit" type="number" step="0.01" placeholder="first entry only"/></div>
              <div><label>Additional Amount</label><input id="peAdditional" type="number" step="0.01"/></div>
              <div><label>Payment Made</label><input id="pePayment" type="number" step="0.01"/></div>
              <div><label>Percentage (%)</label><input id="pePercent" type="number" step="0.01" min="0" max="100" placeholder="e.g., 25"/></div>
              <div><label>Payment Date</label><input id="peDate" type="date"/></div>
              <div><label>Misc</label><input id="peMisc" type="number" step="0.01" placeholder="optional"/></div>
              <div><label>Balance (auto)</label><input id="peBalance" type="number" step="0.01" readonly/></div>
              <div><label>Notes</label><input id="peNotes" placeholder="optional"/></div>
            </div>
            
            <div class="flex-row gap">
              <button id="btnAddEntry" class="primary">Add Entry</button>
              <button id="btnUpdateEntry" class="primary outline" disabled>Update Selected</button>
              <button id="btnClearEntry" class="ghost">Clear All</button>
            </div>
          </details>

          <div class="table-wrap">
            <table id="paymentsTable">
              <thead><tr><th>#</th><th>Credit</th><th>Additional</th><th>Payment</th><th>Misc</th><th>Balance</th><th>Notes</th><th>Action</th></tr></thead>
              <tbody></tbody>
              <tfoot>
                <tr id="paymentsTotals"><td>Σ</td><td>–</td><td>0.00</td><td>0.00</td><td>0.00</td><td>–</td><td></td><td></td></tr>
              </tfoot>
            </table>
          </div>
        </div>
      </section>

      <section id="page-admin-users" class="page">
        <div class="card">
          <h2>Admin • Users</h2>
          <details class="card sub">
            <summary>Add / Update User</summary>
            <div class="grid grid-6 gap">
              <div><label>Account ID</label><input id="uAccId"/></div>
              <div><label>Account Name</label><input id="uAccName"/></div>
              <div><label>Role</label><select id="uRole"><option>admin</option><option selected>user</option></select></div>
              <div><label>Email</label><input id="uEmail" type="email"/></div>
              <div><label>Mobile</label><input id="uMobile" type="tel"/></div>
              <div><label>Password</label><input id="uPassword" type="password"/></div>
            </div>
            <div class="flex-row gap"><button id="btnAddUser" class="primary">Add User</button><button id="btnUpdateUser" class="primary outline" disabled>Update Selected</button><button id="btnClearUser" class="ghost">Clear</button></div>
          </details>
          <div class="table-wrap">
            <table id="usersTable"><thead><tr><th>#</th><th>Account ID</th><th>Account Name</th><th>Role</th><th>Email</th><th>Mobile</th><th>Password</th><th>Action</th></tr></thead><tbody></tbody></table>
          </div>
        </div>
      </section>

      <section id="page-settings" class="page">
        <div class="card"><h2>Settings</h2><p>Use <strong>Search Accounts</strong> (read‑only) or <strong>Admin</strong> (for editing) — login is admin‑only.</p></div>
      </section>
    </main>
  </div>

  <!-- MODALS -->
  <div id="modalBackdrop" class="modal-backdrop" hidden></div>
<!-- Admin Auth Modal -->
  <div id="modalAdmin" class="modal" hidden role="dialog" aria-modal="true">
    <div class="modal-card">
      <div class="modal-header"><h3>Admin Sign In</h3><button class="modal-close" data-close="modalAdmin">✕</button></div>
      <div class="grid grid-3 gap">
        <div><label>Email</label><input id="adminEmail" type="email" placeholder="admin@example.com"/></div>
        <div><label>Password</label><input id="adminPassword" type="password" placeholder="••••••••"/></div>
        <div class="align-end"><button id="btnDoAdminLogin" class="primary">Sign in</button></div>
      </div>
      <p id="adminLoginMsg" class="muted"></p>
    </div>
  </div>

  <script>
    window.__FIREBASE_CONFIG__ = {
      apiKey: "AIzaSyAn7Rq3ehuW3AEurWULg0TvRx3bMXL1wk0",
      authDomain: "monkey-01-d1af0.firebaseapp.com",
      projectId: "monkey-01-d1af0",
      storageBucket: "monkey-01-d1af0.firebasestorage.app",
      messagingSenderId: "345357612688",
      appId: "1:345357612688:web:7215153eabff14c9834a15",
      measurementId: "G-RLZE24P59R",
      databaseURL: "https://monkey-01-d1af0-default-rtdb.firebaseio.com"
    };
  </script>
  <script src="app.js"></script>

  <!-- Mobile Bottom Tab Bar -->
  <nav id="tabbar" class="tabbar">
    <button class="tab" id="tabSearch" data-target="page-search-accounts" aria-label="Search"><span>🔎</span><small>Search</small></button>
    <button class="tab" id="tabPayments" data-target="page-admin-payments" aria-label="Payments"><span>💳</span><small>Payments</small></button>
    <button class="tab" id="tabUsers" data-target="page-admin-users" aria-label="Users"><span>👤</span><small>Users</small></button>
    <button class="tab" id="tabSettings" data-target="page-settings" aria-label="Settings"><span>⚙️</span><small>Settings</small></button>
  </nav>

</body>
</html>
